# Описание продукта: Телеграм-бот программы лояльности

## 1. Точки входа в бота

### 1.1. Способы попадания пользователя в бота:
1. **Через существующий бот**: В уже работающем телеграм-боте появляется новая кнопка «Открыть программу лояльности».
2. **Рассылки**: Все существующие пользователи получают уведомление, что теперь есть мини-приложение для поиска самых выгодных цен.
3. **Новый пользователь**: Может попасть на бота по прямой ссылке/QR-коду или через рекламу.

### 1.2. Первичная логика при открытии:
- **Новый пользователь** (первый запуск) → автоматически попадает на онбординг
- **Существующий пользователь** → сразу попадает на главный экран

⸻

## 2. Онбординг (первое открытие тг-аппки)

### 2.1. Экран 1: Приветственная анимация
- **Содержание**: Анимация «Время чистых эмоций» (визуальная короткая «фишка» для вовлечения)
- **Длительность**: 1-2 секунды
- **Навигация**: 
  - Автоматический переход на следующий экран после завершения анимации
  - Нет кнопок управления (автоматический переход)

### 2.2. Экран 2: Описание функционала
- **Содержание**: Коротко объясняется, что бот помогает подобрать лучшие цены на товары
- **Элементы**:
  - Текст с описанием
  - Кнопка «Далее» (переход к форме)
- **Навигация**:
  - Кнопка «Далее» → переход на экран 3 (форма)
  - Кнопка «Назад» отсутствует (первый экран онбординга)

### 2.3. Экран 3: Форма регистрации
- **Содержание**: Форма с полями для сбора данных
- **Поля формы**:
  - ФИО (обязательное, текстовое поле)
  - Телефон (обязательное, с валидацией формата)
  - Почта (обязательное, с валидацией формата email)
  - Чекбокс «Согласие на обработку персональных данных» (обязательное)
- **Элементы управления**:
  - Кнопка «Назад» → возврат на экран 2 (описание)
  - Кнопка «Подтвердить» (активна только при заполнении всех полей и согласии)
- **Валидация**:
  - При попытке отправить незаполненную форму → показ ошибок под полями
  - При успешной отправке → переход на экран 4 (автоматический поиск)

### 2.4. Экран 4: Автоматический поиск (демонстрация)
- **Содержание**: После подтверждения формы бот автоматически ищет самую выгодную цену на один конкретный товар
- **Элементы**:
  - Анимация поиска (индикатор загрузки)
  - Текст «Ищем лучшую цену...»
- **Навигация**: 
  - Автоматический переход на экран 5 (результаты поиска) после завершения поиска
  - Кнопка «Назад» отсутствует (автоматический процесс)

### 2.5. Экран 5: Результаты поиска (демонстрация)
- **Содержание**: Показывается список результатов со всех маркетплейсов с ценами на выбранный товар
- **Элементы**:
  - Список маркетплейсов с ценами
  - Каждая карточка содержит: название маркетплейса, цену, кнопку «Посмотреть»
- **Навигация**:
  - Кнопка «Назад» → возврат на главный экран (онбординг завершён)
  - Нажатие на карточку маркетплейса → переход на экран 6 (детальная карточка товара)

### 2.6. Экран 6: Карточка товара
- **Содержание**: Детальная информация о товаре на выбранном маркетплейсе
- **Элементы**:
  - Название товара
  - Цена
  - Название маркетплейса
  - Кнопка «Перейти» (открывает маркетплейс в браузере)
- **Навигация**:
  - Кнопка «Назад» → возврат на экран 5 (результаты поиска)
  - Кнопка «Перейти» → открытие браузера с товаром → автоматический возврат на главный экран после закрытия браузера

### 2.7. Завершение онбординга
- После закрытия карточки товара или перехода на маркетплейс → пользователь попадает на главный экран
- Онбординг больше не показывается (флаг сохранён в профиле пользователя)

⸻

## 3. Главный экран бота

### 3.1. Структура главного экрана
- **Элементы**:
  - Заголовок/логотип бота
  - Одна большая кнопка «Поиск» (центральный элемент)
  - Возможно: информация о последних акциях (опционально)

### 3.2. Навигация с главного экрана
- **Кнопка «Поиск»** → переход на экран категорий (раздел 4)

⸻

## 4. Поиск товаров

### 4.1. Экран категорий
- **Содержание**: Список доступных категорий товаров
- **Категории**:
  - «Таблетки для посудомоечных средств»
  - «Средства для стирки»
  - (возможно добавление других категорий в будущем)
- **Элементы управления**:
  - Кнопка «Назад» → возврат на главный экран
  - Каждая категория кликабельна → переход на экран товаров категории

### 4.2. Экран товаров категории
- **Содержание**: Список товаров из выбранной категории
- **Элементы**:
  - Список товаров (карточки с названием и изображением)
  - Возможность прокрутки списка
- **Элементы управления**:
  - Кнопка «Назад» → возврат на экран категорий
  - Нажатие на товар → переход на экран поиска (раздел 4.3)

### 4.3. Экран поиска (анимация и результаты)
- **Этап 1: Анимация поиска**
  - **Содержание**: Визуальная анимация поиска (индикатор загрузки)
  - **Элементы**:
    - Анимация поиска
    - Текст «Ищем лучшие цены...»
  - **Длительность**: 2-3 секунды
  - **Навигация**: Автоматический переход на этап 2 после завершения

- **Этап 2: Результаты поиска**
  - **Содержание**: Список маркетплейсов с ценами на выбранный товар
  - **Элементы**:
    - Список карточек маркетплейсов
    - Каждая карточка содержит: название маркетплейса, цену, кнопку «Посмотреть»
    - Сортировка по цене (от меньшей к большей)
  - **Элементы управления**:
    - Кнопка «Назад» → возврат на экран товаров категории
    - Нажатие на карточку маркетплейса → переход на экран карточки товара (раздел 4.4)

### 4.4. Экран карточки товара
- **Содержание**: Детальная информация о товаре на выбранном маркетплейсе
- **Элементы**:
  - Название товара
  - Изображение товара (если доступно)
  - Цена
  - Название маркетплейса
  - Описание товара (если доступно)
  - Кнопка «Купить» (основное действие)
- **Элементы управления**:
  - Кнопка «Назад» → возврат на экран результатов поиска
  - Кнопка «Купить» → открытие браузера с товаром на маркетплейсе → автоматический возврат на главный экран после закрытия браузера

⸻

## 5. Навигационная схема и зацикленность

### 5.1. Общая схема переходов

```
[Точка входа]
    ↓
[Проверка: новый пользователь?]
    ├─ ДА → [Онбординг] → [Главный экран]
    └─ НЕТ → [Главный экран]
                ↓
        [Кнопка "Поиск"]
                ↓
        [Экран категорий]
                ↓
        [Экран товаров категории]
                ↓
        [Анимация поиска]
                ↓
        [Результаты поиска]
                ↓
        [Карточка товара]
                ↓
        [Браузер с товаром] → [Главный экран]
```

### 5.2. Принцип зацикленности

**Все действия возвращают пользователя на главный экран:**

1. **После завершения онбординга** → главный экран
2. **После закрытия карточки товара** → главный экран
3. **После перехода на маркетплейс (кнопка "Купить"/"Перейти")** → главный экран
4. **Кнопка "Назад" на экране категорий** → главный экран
5. **Любое прерывание процесса** → главный экран

### 5.3. Правила навигации "Назад"

- **Главный экран**: кнопка "Назад" отсутствует (корневой экран)
- **Экран категорий**: "Назад" → главный экран
- **Экран товаров категории**: "Назад" → экран категорий
- **Результаты поиска**: "Назад" → экран товаров категории
- **Карточка товара**: "Назад" → результаты поиска
- **Во время анимации поиска**: кнопка "Назад" отсутствует (автоматический процесс)

### 5.4. Обработка ошибок и edge cases

- **Ошибка сети при поиске**: 
  - Показ сообщения об ошибке
  - Кнопка "Повторить" → повторный поиск
  - Кнопка "Назад" → возврат на предыдущий экран

- **Товар не найден**:
  - Показ сообщения "Товар не найден на маркетплейсах"
  - Кнопка "Назад" → возврат на экран товаров категории

- **Пустые результаты поиска**:
  - Показ сообщения "Нет доступных предложений"
  - Кнопка "Назад" → возврат на экран товаров категории

- **Прерывание онбординга**:
  - При закрытии бота во время онбординга → при следующем открытии онбординг продолжается с того же места

⸻

## 6. Технические детали

### 6.1. Сохранение состояния
- Флаг прохождения онбординга сохраняется в профиле пользователя
- Данные формы регистрации сохраняются после подтверждения
- История поисков может сохраняться для быстрого доступа (опционально)

### 6.2. Интеграции
- Интеграция с API маркетплейсов для получения актуальных цен
- Открытие внешних ссылок в браузере Telegram
- Сохранение данных пользователя в базе данных

### 6.3. Производительность
- Кэширование результатов поиска (на короткое время)
- Оптимизация анимаций для плавной работы
- Минимальное время загрузки экранов
