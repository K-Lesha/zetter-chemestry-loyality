# Список задач для разработки системы

## 1. База данных для парсера

### 1.1. Проектирование схемы БД
- [ ] Проектирование структуры таблиц
- [ ] Определение связей между таблицами
- [ ] Выбор типа БД (PostgreSQL/MySQL/MongoDB)
- [ ] Создание ER-диаграммы

### 1.2. Таблицы для хранения данных парсера
- [ ] **Таблица категорий** (`categories`)
  - id (PK)
  - name (название категории)
  - description (описание, опционально)
  - created_at, updated_at

- [ ] **Таблица товаров** (`products`)
  - id (PK)
  - name (название товара)
  - category_id (FK к categories)
  - image_url (URL картинки товара)
  - base_link (базовая ссылка на маркетплейс)
  - created_at, updated_at

- [ ] **Таблица маркетплейсов** (`marketplaces`)
  - id (PK)
  - name (название маркетплейса)
  - base_url (базовый URL маркетплейса)
  - parser_config (JSON с настройками парсинга для конкретного маркетплейса)
  - created_at, updated_at

- [ ] **Таблица парсинга цен** (`price_data`)
  - id (PK)
  - product_id (FK к products)
  - marketplace_id (FK к marketplaces)
  - price (цена)
  - availability (наличие товара: in_stock/out_of_stock/limited)
  - product_url (актуальная ссылка на товар)
  - parsed_at (время последнего парсинга)
  - created_at, updated_at

- [ ] **Таблица истории цен** (`price_history`)
  - id (PK)
  - price_data_id (FK к price_data)
  - price (цена на момент записи)
  - availability (наличие на момент записи)
  - recorded_at (время записи)

- [ ] **Таблица логов парсинга** (`parsing_logs`)
  - id (PK)
  - product_id (FK к products)
  - marketplace_id (FK к marketplaces)
  - status (success/error)
  - error_message (если ошибка)
  - execution_time (время выполнения)
  - parsed_at

### 1.3. Индексы и оптимизация
- [ ] Создание индексов для частых запросов
  - Индекс на product_id в price_data
  - Индекс на marketplace_id в price_data
  - Индекс на category_id в products
  - Индекс на parsed_at для фильтрации актуальных данных
- [ ] Настройка партиционирования для price_history (по датам)
- [ ] Настройка автоматической очистки старых логов

### 1.4. Миграции и версионирование
- [ ] Настройка системы миграций (если SQL БД)
- [ ] Создание скриптов инициализации БД
- [ ] Документация схемы БД

### 1.5. Резервное копирование
- [ ] Настройка автоматического бэкапа БД
- [ ] План восстановления данных

⸻

## 2. Алгоритм парсера

### 2.1. Архитектура парсера
- [ ] Выбор технологии (Python/Node.js/другое)
- [ ] Проектирование модульной архитектуры
- [ ] Настройка окружения разработки

### 2.2. Модуль получения списка товаров
- [ ] Парсинг входных данных (список товаров от клиента)
- [ ] Валидация входных данных
- [ ] Нормализация данных (приведение к единому формату)
- [ ] Сохранение товаров в БД

### 2.3. Модуль парсинга маркетплейсов
- [ ] **Базовый парсер**
  - Абстрактный класс/интерфейс для парсеров
  - Общая логика обработки запросов
  - Обработка ошибок и повторные попытки

- [ ] **Парсеры для каждого маркетплейса**
  - Парсер для маркетплейса 1
  - Парсер для маркетплейса 2
  - Парсер для маркетплейса N
  - Каждый парсер должен уметь:
    - Извлекать название товара
    - Извлекать цену
    - Извлекать изображение
    - Определять наличие товара
    - Обрабатывать динамический контент (если нужно)

### 2.4. Обработка различных типов страниц
- [ ] Парсинг статических HTML страниц
- [ ] Парсинг динамических страниц (Selenium/Playwright)
- [ ] Обработка JavaScript-рендеринга
- [ ] Обработка AJAX-запросов (если нужно)

### 2.5. Обработка антибот-защиты
- [ ] Ротация User-Agent
- [ ] Использование прокси (если нужно)
- [ ] Задержки между запросами
- [ ] Обработка CAPTCHA (если нужно)
- [ ] Обработка блокировок IP

### 2.6. Извлечение данных
- [ ] Парсинг названия товара (с обработкой вариаций)
- [ ] Парсинг цены (нормализация формата: удаление символов, конвертация валют)
- [ ] Парсинг изображения (скачивание и сохранение URL)
- [ ] Определение наличия товара (in_stock/out_of_stock/limited)
- [ ] Валидация извлечённых данных

### 2.7. Сохранение данных
- [ ] Логика сохранения в БД
- [ ] Обновление существующих записей
- [ ] Создание записей в price_history
- [ ] Обработка дубликатов
- [ ] Транзакционность операций

### 2.8. Планировщик задач
- [ ] Настройка cron/scheduler для запуска каждый час
- [ ] Очередь задач для парсинга
- [ ] Приоритизация задач
- [ ] Обработка сбоев и повторные попытки
- [ ] Логирование выполнения задач

### 2.9. Мониторинг и логирование
- [ ] Логирование всех операций парсинга
- [ ] Отслеживание успешности парсинга
- [ ] Алерты при ошибках
- [ ] Метрики производительности
- [ ] Дашборд для мониторинга (опционально)

### 2.10. Обработка ошибок
- [ ] Обработка сетевых ошибок
- [ ] Обработка ошибок парсинга (изменение структуры страницы)
- [ ] Обработка таймаутов
- [ ] Retry-логика с экспоненциальной задержкой
- [ ] Уведомления о критических ошибках

### 2.11. Конфигурация
- [ ] Файл конфигурации для каждого маркетплейса
- [ ] Настройки селекторов CSS/XPath
- [ ] Настройки задержек и таймаутов
- [ ] Настройки прокси (если используются)

⸻

## 3. Фронтенд для Telegram-бота

### 3.1. Выбор технологии
- [ ] Выбор фреймворка (React/React Native/Vue/нативный Telegram Mini App)
- [ ] Настройка проекта
- [ ] Интеграция с Telegram Web App API

### 3.2. Архитектура приложения
- [ ] Настройка роутинга/навигации
- [ ] Управление состоянием (Redux/Zustand/Context API)
- [ ] Структура папок и компонентов
- [ ] Настройка сборки (Webpack/Vite)

### 3.3. Онбординг
- [ ] **Экран 1: Приветственная анимация**
  - Компонент анимации «Время чистых эмоций»
  - Таймер для автоматического перехода (1-2 сек)
  - Логика перехода на следующий экран

- [ ] **Экран 2: Описание функционала**
  - Компонент с текстом описания
  - Кнопка «Далее»
  - Навигация на экран формы

- [ ] **Экран 3: Форма регистрации**
  - Поле ввода ФИО
  - Поле ввода телефона (с маской и валидацией)
  - Поле ввода email (с валидацией)
  - Чекбокс согласия на обработку данных
  - Кнопка «Назад»
  - Кнопка «Подтвердить» (с валидацией)
  - Отображение ошибок валидации
  - Интеграция с API для отправки данных

- [ ] **Экран 4: Автоматический поиск (демонстрация)**
  - Компонент анимации поиска
  - Индикатор загрузки
  - Текст «Ищем лучшую цену...»
  - Автоматический запрос к API
  - Автоматический переход на результаты

- [ ] **Экран 5: Результаты поиска (демонстрация)**
  - Компонент списка результатов
  - Карточки маркетплейсов с ценами
  - Кнопка «Назад» (возврат на главный экран)
  - Навигация на карточку товара

- [ ] **Экран 6: Карточка товара (онбординг)**
  - Отображение названия товара
  - Отображение цены
  - Отображение названия маркетплейса
  - Кнопка «Перейти» (открытие браузера)
  - Кнопка «Назад»
  - Логика возврата на главный экран

### 3.4. Главный экран
- [ ] Компонент главного экрана
- [ ] Заголовок/логотип
- [ ] Большая кнопка «Поиск»
- [ ] Опционально: блок с акциями
- [ ] Навигация на экран категорий

### 3.5. Поиск товаров
- [ ] **Экран категорий**
  - Компонент списка категорий
  - Карточки категорий
  - Кнопка «Назад» (возврат на главный экран)
  - Навигация на экран товаров категории

- [ ] **Экран товаров категории**
  - Компонент списка товаров
  - Карточки товаров (название + изображение)
  - Прокрутка списка (infinite scroll или пагинация)
  - Кнопка «Назад» (возврат на экран категорий)
  - Навигация на экран поиска

- [ ] **Экран поиска: Анимация**
  - Компонент анимации поиска
  - Индикатор загрузки
  - Текст «Ищем лучшие цены...»
  - Автоматический запрос к API
  - Автоматический переход на результаты

- [ ] **Экран поиска: Результаты**
  - Компонент списка результатов
  - Карточки маркетплейсов с ценами
  - Сортировка по цене (от меньшей к большей)
  - Кнопка «Назад» (возврат на экран товаров)
  - Навигация на карточку товара
  - Обработка пустых результатов

- [ ] **Экран карточки товара**
  - Компонент детальной карточки
  - Название товара
  - Изображение товара
  - Цена
  - Название маркетплейса
  - Описание товара (если доступно)
  - Кнопка «Купить» (открытие браузера)
  - Кнопка «Назад»
  - Логика возврата на главный экран

### 3.6. Обработка ошибок
- [ ] Компонент отображения ошибок
- [ ] Обработка ошибок сети
- [ ] Обработка «Товар не найден»
- [ ] Обработка пустых результатов
- [ ] Кнопка «Повторить» при ошибках
- [ ] Кнопка «Назад» при ошибках

### 3.7. Навигация
- [ ] Система навигации между экранами
- [ ] Обработка кнопки «Назад» на каждом экране
- [ ] Логика возврата на главный экран
- [ ] Сохранение состояния навигации
- [ ] Обработка прерывания онбординга

### 3.8. Интеграция с Telegram
- [ ] Интеграция с Telegram Web App API
- [ ] Получение данных пользователя из Telegram
- [ ] Открытие внешних ссылок через Telegram
- [ ] Обработка событий Telegram (закрытие приложения)
- [ ] Использование Telegram UI компонентов (опционально)

### 3.9. UI/UX компоненты
- [ ] Компонент кнопки (с вариантами стилей)
- [ ] Компонент карточки товара
- [ ] Компонент карточки категории
- [ ] Компонент индикатора загрузки
- [ ] Компонент поля ввода (с валидацией)
- [ ] Компонент чекбокса
- [ ] Компонент модального окна (если нужно)
- [ ] Адаптивная верстка для разных размеров экранов

### 3.10. Анимации
- [ ] Анимация «Время чистых эмоций»
- [ ] Анимация поиска
- [ ] Плавные переходы между экранами
- [ ] Анимации появления элементов
- [ ] Оптимизация производительности анимаций

### 3.11. Оптимизация
- [ ] Ленивая загрузка изображений
- [ ] Кэширование данных
- [ ] Оптимизация размера бандла
- [ ] Минификация и сжатие ресурсов
- [ ] Оптимизация производительности рендеринга

### 3.12. Тестирование
- [ ] Unit-тесты для компонентов
- [ ] Интеграционные тесты
- [ ] E2E тесты (опционально)
- [ ] Тестирование на разных устройствах

⸻

## 4. Бэкенд для Telegram-бота

### 4.1. Выбор технологии и архитектура
- [ ] Выбор фреймворка (Node.js/Python/другое)
- [ ] Настройка проекта
- [ ] Проектирование REST API или GraphQL
- [ ] Структура папок и модулей

### 4.2. Интеграция с Telegram Bot API
- [ ] Настройка бота через BotFather
- [ ] Получение и обработка webhook'ов от Telegram
- [ ] Обработка команд бота
- [ ] Обработка callback-запросов (кнопки)
- [ ] Отправка сообщений пользователям

### 4.3. API endpoints для фронтенда
- [ ] **Аутентификация и пользователи**
  - POST /api/auth/check - проверка пользователя
  - GET /api/user/profile - получение профиля пользователя
  - POST /api/user/register - регистрация нового пользователя
  - PUT /api/user/profile - обновление профиля

- [ ] **Онбординг**
  - POST /api/onboarding/complete - завершение онбординга
  - GET /api/onboarding/status - проверка статуса онбординга
  - POST /api/onboarding/demo-search - демо-поиск для онбординга

- [ ] **Категории и товары**
  - GET /api/categories - получение списка категорий
  - GET /api/categories/:id/products - получение товаров категории
  - GET /api/products/:id - получение информации о товаре

- [ ] **Поиск**
  - POST /api/search - поиск цен на товар
  - GET /api/search/:productId/results - получение результатов поиска

- [ ] **Общее**
  - GET /api/health - проверка здоровья сервиса

### 4.4. Бизнес-логика
- [ ] Логика проверки нового/существующего пользователя
- [ ] Логика онбординга (сохранение прогресса)
- [ ] Логика получения категорий из БД парсера
- [ ] Логика получения товаров по категории
- [ ] Логика поиска цен на товар (запрос к БД парсера)
- [ ] Логика сортировки результатов по цене
- [ ] Логика фильтрации актуальных данных

### 4.5. Работа с БД
- [ ] Подключение к БД пользователей
- [ ] Подключение к БД парсера (read-only)
- [ ] ORM/ODM настройка
- [ ] Миграции БД
- [ ] Оптимизация запросов к БД
- [ ] Кэширование частых запросов (Redis опционально)

### 4.6. Валидация данных
- [ ] Валидация входных данных (JSON Schema/Joi/другое)
- [ ] Валидация данных формы регистрации
- [ ] Валидация параметров запросов
- [ ] Обработка некорректных данных

### 4.7. Обработка ошибок
- [ ] Централизованная обработка ошибок
- [ ] Обработка ошибок БД
- [ ] Обработка ошибок внешних API
- [ ] Логирование ошибок
- [ ] Возврат понятных сообщений об ошибках клиенту

### 4.8. Безопасность
- [ ] Валидация данных от Telegram
- [ ] Защита от SQL-инъекций
- [ ] Защита от XSS
- [ ] Rate limiting
- [ ] Аутентификация запросов от фронтенда
- [ ] Валидация токенов Telegram

### 4.9. Логирование и мониторинг
- [ ] Настройка системы логирования
- [ ] Логирование всех запросов
- [ ] Логирование ошибок
- [ ] Метрики производительности
- [ ] Интеграция с системами мониторинга (опционально)

### 4.10. Кэширование
- [ ] Кэширование списка категорий
- [ ] Кэширование товаров по категориям
- [ ] Кэширование результатов поиска (на короткое время)
- [ ] Стратегия инвалидации кэша
- [ ] Настройка Redis (если используется)

### 4.11. Производительность
- [ ] Оптимизация запросов к БД
- [ ] Пагинация для больших списков
- [ ] Асинхронная обработка запросов
- [ ] Оптимизация ответов API

### 4.12. Тестирование
- [ ] Unit-тесты для бизнес-логики
- [ ] Интеграционные тесты для API
- [ ] Тесты работы с БД
- [ ] Тесты интеграции с Telegram API

### 4.13. Документация API
- [ ] Документация всех endpoints
- [ ] Примеры запросов и ответов
- [ ] Описание ошибок
- [ ] Swagger/OpenAPI документация (опционально)

⸻

## 5. База данных для Telegram-бота

### 5.1. Проектирование схемы БД
- [ ] Проектирование структуры таблиц
- [ ] Определение связей между таблицами
- [ ] Выбор типа БД (PostgreSQL/MySQL/MongoDB)
- [ ] Создание ER-диаграммы

### 5.2. Таблицы для хранения данных пользователей
- [ ] **Таблица пользователей** (`users`)
  - id (PK)
  - telegram_id (уникальный ID пользователя в Telegram)
  - first_name (имя)
  - last_name (фамилия, опционально)
  - username (username в Telegram, опционально)
  - phone (телефон)
  - email (email)
  - onboarding_completed (флаг прохождения онбординга)
  - onboarding_step (текущий шаг онбординга, если не завершён)
  - created_at, updated_at

- [ ] **Таблица согласий** (`consents`)
  - id (PK)
  - user_id (FK к users)
  - consent_type (тип согласия: personal_data)
  - accepted (принято/не принято)
  - accepted_at (время принятия)
  - created_at, updated_at

- [ ] **Таблица истории поисков** (`search_history`) - опционально
  - id (PK)
  - user_id (FK к users)
  - product_id (ID товара из БД парсера)
  - searched_at (время поиска)
  - created_at

- [ ] **Таблица сессий** (`sessions`) - опционально
  - id (PK)
  - user_id (FK к users)
  - session_token (токен сессии)
  - expires_at (время истечения)
  - created_at, updated_at

### 5.3. Индексы и оптимизация
- [ ] Индекс на telegram_id в users (для быстрого поиска)
- [ ] Индекс на user_id в consents
- [ ] Индекс на user_id в search_history (если используется)
- [ ] Индекс на onboarding_completed для фильтрации
- [ ] Оптимизация запросов

### 5.4. Миграции и версионирование
- [ ] Настройка системы миграций
- [ ] Создание скриптов инициализации БД
- [ ] Документация схемы БД

### 5.5. Резервное копирование
- [ ] Настройка автоматического бэкапа БД
- [ ] План восстановления данных
- [ ] Политика хранения резервных копий

### 5.6. Интеграция с БД парсера
- [ ] Настройка подключения к БД парсера (read-only)
- [ ] Документация структуры данных парсера для бэкенда
- [ ] Оптимизация запросов к БД парсера

⸻

## 6. Дополнительные задачи

### 6.1. Инфраструктура
- [ ] Настройка серверов/хостинга
- [ ] Настройка CI/CD
- [ ] Настройка доменов и SSL-сертификатов
- [ ] Настройка мониторинга серверов
- [ ] Настройка алертинга

### 6.2. Документация
- [ ] Техническая документация проекта
- [ ] Документация API
- [ ] Документация для разработчиков
- [ ] Инструкции по развёртыванию
- [ ] README файлы для каждого компонента

### 6.3. Тестирование интеграции
- [ ] Интеграционное тестирование всей системы
- [ ] Тестирование взаимодействия компонентов
- [ ] Нагрузочное тестирование
- [ ] Тестирование на реальных данных

### 6.4. Безопасность
- [ ] Аудит безопасности
- [ ] Настройка файрволов
- [ ] Настройка защиты от DDoS
- [ ] Шифрование чувствительных данных
- [ ] Соответствие GDPR (для персональных данных)

### 6.5. Аналитика
- [ ] Настройка аналитики использования бота
- [ ] Отслеживание конверсий
- [ ] Метрики производительности
- [ ] Дашборды для анализа

